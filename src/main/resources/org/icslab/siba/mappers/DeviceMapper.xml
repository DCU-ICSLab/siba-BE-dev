<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.icslab.siba.mappers.DeviceMapper">

    <select id="getDevice" resultMap="Device" parameterType="String">
        SELECT * FROM dev
        where auth_key=#{authKey}
    </select>

    <select id="getBox" resultMap="TextBox" parameterType="String">
        SELECT box.box_id,
               box.pre_text,
               box.post_text,
               box.box_type,
               box.xaxis,
               box.yaxis,
               box.height,
               d.pbox_id,
               d.btn_code
        FROM box as box
        LEFT OUTER JOIN derivation as d
        on box.box_id = d.cbox_id
        where auth_key=#{authKey}
        ORDER BY box.box_id;
    </select>

    <select id="getBtnAndDerivation" resultMap="BtnDerivationJoin" parameterType="String">
        SELECT btn.box_id,
               btn.btn_code,
               btn.ev_code,
               btn.is_spread,
               btn.idx,
               btn.btn_name,
               btn.idx,
               d.cbox_id,
               d.mx,
               d.my,
               d.zx,
               d.zy
        FROM btn as btn, box as box
        LEFT OUTER JOIN derivation as d
        ON box.box_id = d.pbox_id
        WHERE box.auth_key = #{authKey}
        order by btn.box_id, btn.idx;
    </select>

    <!-- userId를 이용하여 userinfo get -->
    <select id="getDevices" resultMap="Device" parameterType="Long">
        SELECT v.vhub_id,
               d.box_id_cnt,
               d.code_cnt,
               d.evcode_cnt,
               d.have_entry,
               d.auth_key,
               d.dev_name,
               d.dev_def_name,
               d.dev_type,
               d.category
        FROM vhub as v
        LEFT OUTER JOIN dev as d
        ON v.vhub_id = d.vhub_id
        WHERE v.users_id = #{userId};
    </select>
    
    <update id="updateDevice" parameterType="org.icslab.siba.devices.device.domain.DeviceDTO">
        UPDATE dev
        SET box_id_cnt=#{boxIdCnt}, code_cnt=#{codeCnt}, have_entry=#{haveEntry}
        WHERE auth_key=#{authKey}
    </update>

    <!--<insert id="multipleTableMultipleInsert">

    </insert>-->

    <resultMap id="Device" type="org.icslab.siba.devices.device.domain.DeviceDTO">
        <result property="authKey" column="auth_key"/>
        <result property="vHubId" column="vhub_id"/>
        <result property="devName" column="dev_name"/>
        <result property="devDefName" column="dev_def_name"/>
        <result property="devType" column="dev_type"/>
        <result property="category" column="category"/>
        <result property="boxIdCnt" column="box_id_cnt"/>
        <result property="codeCnt" column="code_cnt"/>
        <result property="evCodeCnt" column="evcode_cnt"/>
        <result property="haveEntry" column="have_entry"/>
    </resultMap>

    <resultMap id="BtnDerivationJoin" type="org.icslab.siba.devices.device.domain.BtnDerivationJoinVO">
        <result property="boxId" column="box_id"/>
        <result property="btnCode" column="btn_code"/>
        <result property="btnName" column="btn_name"/>
        <result property="idx" column="idx"/>
        <result property="eventCode" column="ev_code"/>
        <result property="isSpread" column="is_spread"/>
        <result property="cBoxId" column="cbox_id"/>
        <result property="mx" column="mx"/>
        <result property="my" column="my"/>
        <result property="zx" column="zx"/>
        <result property="zy" column="zy"/>
    </resultMap>

    <resultMap id="TextBox" type="org.icslab.siba.devices.device.domain.TextBoxVO">
        <result property="boxId" column="box_id"/>
        <result property="preText" column="pre_text"/>
        <result property="postText" column="post_text"/>
        <result property="boxType" column="box_type"/>
        <result property="xAxis" column="xaxis"/>
        <result property="yAxis" column="yaxis"/>
        <result property="height" column="height"/>
        <result property="pBoxId" column="pbox_id"/>
        <result property="btnCode" column="btn_code"/>
    </resultMap>
</mapper>